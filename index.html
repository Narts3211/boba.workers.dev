<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Her ≈ûeyi Bilen Okuyucunun Bakƒ±≈ü A√ßƒ±sƒ±</title>
    <style>
        :root { --bg: #0b0e14; --card: rgba(21, 25, 33, 0.85); --accent: #3498db; --text: #d1d1d1; --success: #2ecc71; --danger: #e74c3c; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body { 
            background-color: var(--bg); 
            background-image: none !important;
            color: #fff; 
            font-family: 'Segoe UI', sans-serif; 
            min-height: 100vh;
        }

        .main-bg {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            background-repeat: no-repeat !important;
            background-size: cover !important;
            background-position: center !important;
            background-attachment: fixed !important;
            transition: background 0.8s ease-in-out; 
        }

        .bg-main { background-image: linear-gradient(to bottom, rgba(11, 14, 20, 0.3), rgba(11, 14, 20, 1)), url('tumblr.jpg') !important; }
        .bg-side { background-image: linear-gradient(to bottom, rgba(11, 14, 20, 0.3), rgba(11, 14, 20, 1)), url('side_story_bg.jpg') !important; }

        .hero { 
            height: 85vh; 
            display: flex; 
            flex-direction: column;
            align-items: center; 
            justify-content: center; 
            text-align: center; 
            padding: 20px;
        }

        h1 { 
            color: var(--accent); 
            font-size: 2.5rem; 
            text-shadow: 0 0 20px rgba(52, 152, 219, 0.5), 0 5px 15px #000; 
            margin-bottom: 10px; 
            font-weight: 900;
        }

        #ai-log { font-size: 0.9rem; color: var(--success); margin-bottom: 30px; font-family: 'Courier New', monospace; }

        #search-box { 
            width: 100%; 
            max-width: 400px; 
            padding: 15px 25px; 
            background: rgba(0, 0, 0, 0.6); 
            border: 1px solid rgba(52, 152, 219, 0.3); 
            border-radius: 30px; 
            color: #fff; 
            text-align: center; 
            outline: none; 
            backdrop-filter: blur(10px);
            transition: 0.3s;
        }

        .tab-container { display: flex; gap: 10px; margin-bottom: 20px; width: 100%; max-width: 400px; }
        .tab-btn { flex: 1; padding: 12px; background: rgba(0,0,0,0.5); border: 1px solid rgba(52, 152, 219, 0.3); color: #fff; border-radius: 15px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .tab-btn.active { background: var(--accent); border-color: var(--accent); box-shadow: 0 0 15px var(--accent); }

        .container { max-width: 1200px; margin: -50px auto 100px; padding: 0 20px; }
        .chapter-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; }
        
        .chapter-card { background: var(--card); padding: 30px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.05); cursor: pointer; position: relative; transition: 0.4s; backdrop-filter: blur(15px); }
        .chapter-card:hover { border-color: var(--accent); transform: translateY(-8px); background: rgba(21, 25, 33, 0.95); }
        
        /* Okundu G√∂rsel Efekti */
        .chapter-card.read { border-color: var(--success) !important; opacity: 0.7; }
        .chapter-card.read::after { content: '‚úì OKUNDU'; position: absolute; bottom: 10px; right: 20px; font-size: 0.7rem; color: var(--success); font-weight: 800; }

        .view-count { position: absolute; top: 15px; right: 20px; font-size: 0.8rem; color: var(--accent); font-weight: bold; }
        .chapter-card span { color: var(--accent); font-size: 0.75rem; font-weight: 800; text-transform: uppercase; }
    </style>
</head>
<body>
    <div id="dynamic-bg" class="main-bg bg-main"></div>
    <section class="hero">
        <div class="hero__content">
            <h1>HER ≈ûEYƒ∞ Bƒ∞LEN OKUYUCUNUN BAKI≈û A√áISI</h1>
            <div id="ai-log">[Sistem]: Veriler hazƒ±rlanƒ±yor...</div>
            <div class="tab-container">
                <button onclick="switchCategory('main')" id="btn-main" class="tab-btn active">Ana Hikaye</button>
                <button onclick="switchCategory('side')" id="btn-side" class="tab-btn">Side Story</button>
            </div>
            <input type="text" id="search-box" placeholder="B√∂l√ºm ara..." onkeyup="filterChapters()">
        </div>
    </section>
    <div class="container">
        <div id="chapter-list" class="chapter-grid"></div>
    </div>

    <script>
        let mainChapters = [];
        let sideChapters = [];
        let currentCategory = 'main';
        // Hafƒ±zadaki listeyi al
        let readStatus = JSON.parse(localStorage.getItem('read_chapters')) || [];

        async function init() {
            try {
                const resMain = await fetch('bolumler.json?v=' + Date.now());
                const dataMain = await resMain.json();
                mainChapters = Object.keys(dataMain).map(k => ({ id: k, title: dataMain[k], type: 'main' }));

                const resSide = await fetch('yan_hikayeler.json?v=' + Date.now());
                const dataSide = await resSide.json();
                sideChapters = Object.keys(dataSide).map(k => ({ id: k, title: dataSide[k], type: 'side' }));

                renderChapters(mainChapters);
                document.getElementById('ai-log').innerText = "[Sistem]: G√ºncel b√∂l√ºmler y√ºklendi.";
            } catch(e) { 
                document.getElementById('ai-log').innerText = "[Hata]: Veriler √ßekilemedi.";
            }
        }

        // Tƒ±klandƒ±ƒüƒ±nda hem kaydet hem a√ß
        function handleChapterClick(id, type) {
            const chapterKey = `${type}-${id}`;
            if (!readStatus.includes(chapterKey)) {
                readStatus.push(chapterKey);
                localStorage.setItem('read_chapters', JSON.stringify(readStatus));
            }
            location.href = `oku.html?b=${id}&t=${type}`;
        }

        function renderChapters(chs) {
            const list = document.getElementById('chapter-list');
            list.innerHTML = chs.map(c => {
                const isRead = readStatus.includes(`${c.type}-${c.id}`);
                return `
                    <div class="chapter-card ${isRead ? 'read' : ''}" onclick="handleChapterClick('${c.id}', '${c.type}')">
                        <div class="view-count">üëÅÔ∏è Oku</div>
                        <span>${c.type === 'main' ? 'B√∂l√ºm' : 'Side Story'} ${c.id}</span>
                        <div style="font-weight:bold; margin-top:10px;">${c.title}</div>
                    </div>
                `;
            }).join('');
        }

        function switchCategory(cat) {
            currentCategory = cat;
            const bgDiv = document.getElementById('dynamic-bg');
            document.getElementById('btn-main').classList.toggle('active', cat === 'main');
            document.getElementById('btn-side').classList.toggle('active', cat === 'side');
            if (cat === 'side') {
                bgDiv.classList.replace('bg-main', 'bg-side');
                renderChapters(sideChapters);
            } else {
                bgDiv.classList.replace('bg-side', 'bg-main');
                renderChapters(mainChapters);
            }
        }

        function filterChapters() {
            const v = document.getElementById('search-box').value.toLowerCase();
            const list = currentCategory === 'main' ? mainChapters : sideChapters;
            renderChapters(list.filter(c => c.id.toString().includes(v) || c.title.toLowerCase().includes(v)));
        }

        init();
    </script>
</body>
</html>